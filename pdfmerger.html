<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DimTools - PDF Merger</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        @import url("https://unpkg.com/papercss@1.9.2/dist/paper.css");
        
        /* Navigation styling matching the template */
        li:has(~ .current)::after {
            content: "/";
            margin-inline-start: 10px;
        }

        li:has(~ li:not(a))::after {
            content: "/";
            margin-inline-start: 10px;
        }

        body {
            display: grid;
            place-items: center;
            min-height: 100vh;
            background-color: #f6eee3;
            background-size: 20px 20px;
            background-image: repeating-linear-gradient(0deg, #e5decf, #e5decf 1px, #f6eee3 1px, #f6eee3);
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        ul {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        ul li::before {
            content: "";
        }
        
        /* Main container */
        .container {
            width: 100%;
            max-width: 1200px;
            min-height: calc(100vh - 120px);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        /* Upload area styling */
        .upload-area {
            background: white;
            border-radius: 5px;
            padding: 2rem;
            text-align: center;
            border: 2px dashed #8b4513;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 1rem;
        }
        
        .upload-area:hover {
            background: #f9f5eb;
            border-color: #a0522d;
        }
        
        .upload-area.dragover {
            background: #f0e6d6;
            border-color: #8b4513;
            border-style: solid;
        }
        
        /* Configuration sections */
        .config-section {
            background: white;
            border-radius: 5px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .section-title {
            color: #8b4513;
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.3rem;
            border-bottom: 2px solid #e5decf;
            padding-bottom: 0.5rem;
        }
        
        /* File list styling */
        .file-list-container {
            background: white;
            border-radius: 5px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            background: #f9f5eb;
            border: 1px solid #e5decf;
            border-radius: 3px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s;
        }
        
        .file-item:hover {
            background: #f0e6d6;
            border-color: #d7c9b5;
        }
        
        .file-name {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #5d4037;
        }
        
        .file-size {
            font-size: 0.8rem;
            color: #795548;
            font-style: italic;
        }
        
        /* Button groups */
        .button-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }
        
        .button-group button {
            flex: 1;
            min-width: 150px;
        }
        
        /* Status messages */
        .status-message {
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .status-message.processing {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
            display: block;
        }
        
        /* Instructions */
        .instructions {
            background: white;
            border-radius: 5px;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .instructions h3 {
            color: #8b4513;
            margin-top: 0;
        }
        
        .instructions ul {
            display: block;
            margin-left: 1.5rem;
        }
        
        .instructions li {
            margin-bottom: 0.5rem;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 1rem;
            color: #666;
            font-size: 0.9rem;
            margin-top: 2rem;
            background: white;
            border-radius: 5px;
            border: 1px solid #e5decf;
        }
        
        .footer p {
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
            font-style: italic;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            flex-direction: column;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #8b4513;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Info box */
        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border-radius: 5px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-top: 0;
            margin-bottom: 0.75rem;
        }
        
        .info-box ul {
            display: block;
            margin-left: 1.5rem;
        }
        
        .info-box li {
            margin-bottom: 0.5rem;
        }
        
        /* File name display */
        .selected-file-name {
            display: inline-block;
            margin-left: 1rem;
            color: #5d4037;
            font-weight: bold;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                height: auto;
                min-height: calc(100vh - 120px);
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group button {
                width: 100%;
            }
            
            .upload-area {
                padding: 1.5rem;
            }
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #795548;
            font-style: italic;
        }
    </style>
</head>
<body>
<a href="index.html" style="position: absolute; top: 20px; left: 20px; z-index: 1000; width: fit-content; text-decoration: none; color: inherit; display: inline-block;">
    <ul class="paper border shadow large-shadow shadow-hover" style="margin: 0; padding: 0.75rem 1.5rem; display: inline-flex; white-space: nowrap; list-style: none; cursor: pointer;">
        <li style="margin: 0;">Home</li>
    </ul>
</a>
    <!-- Main Container -->
    <div class="container">
        <div class="upload-area paper border shadow" id="uploadArea">
            <h2>PDF Merger</h2>
            <p>Combine multiple PDF files into a single document</p>
            <p><small>Drag & drop PDF files here or click to browse</small></p>
            <input type="file" id="pdfInput" multiple accept=".pdf" style="display: none;">
        </div>
        
        <div class="info-box">
            <h3>How This Works</h3>
            <ul>
                <li>Upload two or more PDF files</li>
                <li>Files are combined in the order they appear in the list</li>
                <li>All processing happens locally in your browser</li>
                <li>No file size or page count limitations</li>
                <li>Your files never leave your computer</li>
            </ul>
        </div>
        
        <div class="config-section paper border shadow">
            <h3 class="section-title">1. Select PDF Files</h3>
            <button class="btn-primary" onclick="document.getElementById('pdfInput').click()">
                Choose PDF Files
            </button>
            <span id="selectedFilesCount" class="selected-file-name">No files selected</span>
        </div>
        
        <div class="file-list-container" id="fileListContainer">
            <h3 class="section-title">Selected Files</h3>
            <div id="fileList" class="empty-state">
                No PDF files selected yet. Click "Choose PDF Files" or drag files into the upload area.
            </div>
        </div>
        
        <div class="config-section paper border shadow">
            <h3 class="section-title">2. Configure Output</h3>
            <div style="margin-bottom: 1rem;">
                <label for="outputName" style="display: block; margin-bottom: 0.5rem; font-weight: bold; color: #5d4037;">
                    Output Filename:
                </label>
                <input type="text" id="outputName" value="merged-document" 
                       style="width: 100%; padding: 0.75rem; border: 2px solid #e5decf; border-radius: 3px; font-family: inherit; font-size: 1rem;">
                <div style="font-size: 0.85rem; color: #795548; margin-top: 0.5rem; font-style: italic;">
                    The merged PDF will be saved with this name
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-primary" onclick="mergePDFs()">Merge PDFs</button>
            <button class="btn-secondary" onclick="clearFiles()">Clear All Files</button>
        </div>
        
        <div id="statusMessage" class="status-message"></div>
        
        <div class="instructions paper border shadow">
            <h3>About This Tool</h3>
            <p>This PDF Merger tool allows you to combine multiple PDF documents into a single file while maintaining the original page order and content quality. Unlike many online PDF tools, this application processes your files entirely within your browser.</p>
            <p>All operations are performed client-side using JavaScript libraries, meaning your sensitive documents never leave your computer. There are no file size restrictions, no page count limitations, and no waiting for server processing. This makes it ideal for merging large documents, confidential files, or when working offline.</p>
            <p>The merger preserves the exact content and formatting of your original PDFs, combining them in the order they appear in your file list. You can reorder files by selecting them in your preferred sequence before uploading. The entire process is secure, private, and instantaneousâ€”your data remains under your complete control from start to finish.</p>
        </div>
        
        <div class="footer">
            <p>DimTools - PDF Merger | All data processing happens locally in your browser</p>
        </div>
    </div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <h3>Merging PDF files...</h3>
        <p>Processing pages and creating combined document</p>
    </div>

    <!-- Scripts -->
    <script src="script.js"></script>
    
    <script>
        // DOM Elements
        const pdfInput = document.getElementById('pdfInput');
        const uploadArea = document.getElementById('uploadArea');
        const fileList = document.getElementById('fileList');
        const fileListContainer = document.getElementById('fileListContainer');
        const statusMessage = document.getElementById('statusMessage');
        const selectedFilesCount = document.getElementById('selectedFilesCount');
        const outputName = document.getElementById('outputName');
        const loadingOverlay = document.getElementById('loadingOverlay');
        
        // State variables
        let files = [];
        
        // Event Listeners
        uploadArea.addEventListener('click', () => pdfInput.click());
        
        pdfInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                addFiles(Array.from(e.target.files));
            }
        });
        
        // Drag and drop functionality
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length > 0) {
                const droppedFiles = Array.from(e.dataTransfer.files).filter(file => 
                    file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')
                );
                
                if (droppedFiles.length > 0) {
                    addFiles(droppedFiles);
                } else {
                    showStatus('Please upload PDF files only', 'error');
                }
            }
        });
        
        // Add files to the list
        function addFiles(newFiles) {
            // Filter out non-PDF files
            const pdfFiles = newFiles.filter(file => 
                file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')
            );
            
            if (pdfFiles.length === 0) {
                showStatus('Please select PDF files only', 'error');
                return;
            }
            
            // Add to files array
            files.push(...pdfFiles);
            updateFileList();
            showStatus(`Added ${pdfFiles.length} PDF file(s)`, 'success');
        }
        
        // Update the file list display
        function updateFileList() {
            if (files.length === 0) {
                fileList.innerHTML = '<div class="empty-state">No PDF files selected yet. Click "Choose PDF Files" or drag files into the upload area.</div>';
                selectedFilesCount.textContent = 'No files selected';
                return;
            }
            
            let fileListHTML = '';
            files.forEach((file, index) => {
                const size = formatFileSize(file.size);
                fileListHTML += `
                    <div class="file-item">
                        <div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${size}</div>
                        </div>
                        <button class="btn-small" onclick="removeFile(${index})" style="background: none; border: none; color: #dc3545; cursor: pointer; padding: 0.25rem 0.5rem;">
                            Remove
                        </button>
                    </div>
                `;
            });
            
            fileList.innerHTML = fileListHTML;
            selectedFilesCount.textContent = `${files.length} file${files.length !== 1 ? 's' : ''} selected`;
        }
        
        // Remove a file from the list
        function removeFile(index) {
            if (index >= 0 && index < files.length) {
                const removedFile = files.splice(index, 1)[0];
                updateFileList();
                showStatus(`Removed: ${removedFile.name}`, 'success');
            }
        }
        
        // Clear all files
        function clearFiles() {
            if (files.length === 0) {
                showStatus('No files to clear', 'error');
                return;
            }
            
            files = [];
            updateFileList();
            showStatus('All files cleared', 'success');
        }
        
        // Show status message
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    if (statusMessage.className.includes('success')) {
                        statusMessage.style.display = 'none';
                    }
                }, 5000);
            }
        }
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Merge PDFs
        async function mergePDFs() {
            if (files.length < 2) {
                showStatus('Please select at least 2 PDF files to merge', 'error');
                return;
            }
            
            // Show loading overlay
            loadingOverlay.classList.add('active');
            showStatus('Processing PDF files...', 'processing');
            
            try {
                const mergedPdf = await PDFLib.PDFDocument.create();
                
                // Process each file in sequence
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    
                    try {
                        // Read file as ArrayBuffer
                        const fileReader = new FileReader();
                        const fileBytes = await new Promise((resolve, reject) => {
                            fileReader.onload = () => resolve(new Uint8Array(fileReader.result));
                            fileReader.onerror = reject;
                            fileReader.readAsArrayBuffer(file);
                        });
                        
                        // Load PDF document
                        const pdfDoc = await PDFLib.PDFDocument.load(fileBytes);
                        
                        // Copy all pages
                        const pages = await mergedPdf.copyPages(pdfDoc, pdfDoc.getPageIndices());
                        pages.forEach(page => mergedPdf.addPage(page));
                        
                        // Update status
                        showStatus(`Processed ${i + 1} of ${files.length}: ${file.name}`, 'processing');
                        
                    } catch (error) {
                        console.error(`Error processing ${file.name}:`, error);
                        throw new Error(`Failed to process "${file.name}": ${error.message}`);
                    }
                }
                
                // Save merged PDF
                const mergedPdfBytes = await mergedPdf.save();
                
                // Create download
                const blob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                
                // Use custom filename or default
                const fileName = outputName.value.trim() || 'merged-document';
                link.download = `${fileName}.pdf`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                // Success
                showStatus(`Successfully merged ${files.length} PDF files into ${fileName}.pdf`, 'success');
                
            } catch (error) {
                console.error('Merge error:', error);
                showStatus(`Error: ${error.message}`, 'error');
            } finally {
                loadingOverlay.classList.remove('active');
            }
        }
    </script>
</body>
</html>
